name: Update README

on:
  push:
    paths:
      - 'problems.txt' # problems.txt가 수정될 때 실행
  workflow_dispatch: # 수동 실행 버튼

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 쓰기 권한 부여

    steps:
    - uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Run script
      run: python update_readme.py

    - name: Commit and Push
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # README.md를 스테이징 영역에 추가
        git add README.md
        
        # 변경 사항이 있는지 확인 (디버깅용 로그 출력)
        echo "현재 git status 상태:"
        git status
        
        # 커밋 시도 (변경사항이 없으면 에러가 나지 않도록 처리)
        git commit -m "Auto-update README with problem links" || echo "⚠️ 변경된 내용이 없어 커밋하지 않았습니다."
        
        # 현재 브랜치 이름(HEAD)을 자동으로 찾아서 푸시 (main/master 자동 대응)
        git push origin HEAD:${{ github.ref }}